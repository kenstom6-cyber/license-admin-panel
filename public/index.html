<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>License Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background: linear-gradient(120deg, #0f172a, #020617);
      color: #e5e7eb;
    }

    .container {
      max-width: 900px;
      margin: 40px auto;
      padding: 30px;
      background: rgba(15, 23, 42, 0.85);
      border-radius: 12px;
      box-shadow: 0 0 30px rgba(0,0,0,0.6);
    }

    h1 {
      margin-top: 0;
      margin-bottom: 20px;
    }

    h2 {
      margin-top: 40px;
      border-bottom: 1px solid #334155;
      padding-bottom: 8px;
    }

    label {
      display: block;
      margin-top: 12px;
      margin-bottom: 4px;
      font-size: 14px;
    }

    input {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: none;
      outline: none;
      background: #020617;
      color: #e5e7eb;
    }

    button {
      margin-top: 12px;
      padding: 10px 16px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: bold;
      background: #2563eb;
      color: white;
    }

    button.danger {
      background: #dc2626;
    }

    button.secondary {
      background: #475569;
    }

    pre {
      background: #020617;
      padding: 12px;
      border-radius: 6px;
      margin-top: 10px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .status {
      margin-top: 15px;
      padding: 10px;
      border-radius: 6px;
      background: #020617;
      color: #fca5a5;
    }

    .ok {
      color: #86efac;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>üîê License Admin Panel</h1>

  <!-- ================= USER ACTION ================= -->
  <h2>Client / User</h2>

  <label>License Key</label>
  <input id="licenseKey" placeholder="XXXX-XXXX-XXXX" />

  <label>HWID</label>
  <input id="hwid" placeholder="PC-0101" />

  <button onclick="activate()">Activate License</button>
  <button class="secondary" onclick="verify()">Verify License</button>

  <!-- ================= ADMIN ================= -->
  <h2>Admin</h2>

  <button onclick="createKey()">Create License Key</button>
  <button class="secondary" onclick="resetKey()">Reset Key</button>
  <button class="danger" onclick="lockKey()">Lock (Revoke) Key</button>

  <!-- ================= SERVER KEY ================= -->
  <h2>Server / CLI</h2>

  <p>Server key (d√πng cho shell script):</p>
  <pre id="serverKey">x-server-key: &lt;SERVER_KEY_C·ª¶A_B·∫†N&gt;</pre>

  <p>V√≠ d·ª• verify b·∫±ng shell:</p>
  <pre>
curl -X POST https://license-worker.kenstom6.workers.dev/verify-cli \
-H "Content-Type: application/json" \
-H "x-server-key: &lt;SERVER_KEY&gt;" \
-d '{"licenseKey":"KEY","hwid":"PC-0101"}'
  </pre>

  <!-- ================= RESULT ================= -->
  <div id="result" class="status">Ch∆∞a c√≥ thao t√°c</div>
</div>

<script>
/* ================= CONFIG ================= */
const API = "https://license-worker.kenstom6.workers.dev";

/* ================= HELPERS ================= */
function showResult(data, ok = false) {
  const el = document.getElementById("result");
  el.textContent = JSON.stringify(data, null, 2);
  el.className = "status " + (ok ? "ok" : "");
}

async function post(path, body) {
  const res = await fetch(API + path, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(body)
  });
  return res.json();
}

/* ================= CLIENT ================= */
async function activate() {
  try {
    const licenseKey = document.getElementById("licenseKey").value;
    const hwid = document.getElementById("hwid").value;
    const data = await post("/activate", { licenseKey, hwid });
    showResult(data, !!data.success);
  } catch {
    showResult({ error: "L·ªói k·∫øt n·ªëi API" });
  }
}

async function verify() {
  try {
    const licenseKey = document.getElementById("licenseKey").value;
    const hwid = document.getElementById("hwid").value;
    const data = await post("/verify", { licenseKey, hwid });
    showResult(data, !!data.valid);
  } catch {
    showResult({ error: "L·ªói k·∫øt n·ªëi API" });
  }
}

/* ================= ADMIN ================= */
async function createKey() {
  try {
    const data = await post("/create", {});
    document.getElementById("licenseKey").value = data.licenseKey;
    showResult(data, true);
  } catch {
    showResult({ error: "Kh√¥ng t·∫°o ƒë∆∞·ª£c key" });
  }
}

async function resetKey() {
  try {
    const licenseKey = document.getElementById("licenseKey").value;
    const data = await post("/reset", { licenseKey });
    showResult(data, true);
  } catch {
    showResult({ error: "Reset th·∫•t b·∫°i" });
  }
}

async function lockKey() {
  try {
    const licenseKey = document.getElementById("licenseKey").value;
    const data = await post("/lock", { licenseKey });
    showResult(data, true);
  } catch {
    showResult({ error: "Lock key th·∫•t b·∫°i" });
  }
}
</script>

</body>
</html>
